<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible" />
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />

  
    
  

  
    
  

  
    
  

  

  
    
  

  <title>On-critical-path Migration</title>

  
    <meta name="title" content="On-critical-path Migration">
    <meta name="author" content="Junliang Hu">
    <meta name="description" content="Junliang Hu&#x27;s homepage">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jlhu.io/2024-01/on-critical-path-migration/">
    <meta property="og:site_name" content="Junliang Hu 胡俊良">
    <meta property="og:title" content="On-critical-path Migration">
    <meta property="og:description" content="Junliang Hu&#x27;s homepage">
    

    
    
      <meta property="twitter:card" content="summary_large_image">
      <meta property="twitter:url" content="https://jlhu.io/2024-01/on-critical-path-migration/">
      <meta property="twitter:title" content="On-critical-path Migration">
      <meta property="twitter:description" content="Junliang Hu&#x27;s homepage">
      
    

    <link rel="canonical" href="https://jlhu.io/2024-01/on-critical-path-migration/">
    
    <script type="application/ld+json">
      {
          "description": "Junliang Hu's homepage",
          "url": "https://jlhu.io/2024-01/on-critical-path-migration/",
          "@type": "WebSite",
          "headline": "On-critical-path Migration",
          "name": "On-critical-path Migration",
          "author": { "@type": "Person", "name": "Junliang Hu" },
          "@context":"https://schema.org"
      }
    </script>
  

  

   
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // • rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>
  

  
    <link rel="stylesheet" href="https://jlhu.io/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
  
</head>

<body theme="auto">
  <div class="w">
    <header>
      
        <nav>
          
            <a href="/" >~jlhu</a>
          
            <a href="/tags" >#tags</a>
          
        </nav>
      

      
  <p>
    <a href="..">..</a>/on-critical-path-migration
  </p>
  <p class="post-meta">
    <time datetime="2024-01-12">2024-01-12</time>
  </p>
  <h1>On-critical-path Migration</h1>

    </header>

    <main class="page-content" aria-label="Content">
      
  

  <p>To reduce the latency between finding a hot page and migrating it to fast memory,
we can try using synchronous migration.
To implement this,
the most intuitive solution is to extend the existing NUMA hinting page faults.
We have known that NUMA faults have the ability to migrate a page during page fault handling.
But the problem is 1) how to trigger NUMA faults for our desired pages and
2) how to ensure the NUMA faults carry out migration instead of only being used to collect access samples.</p>
<h2 id="numa-faults-triggering">NUMA faults triggering</h2>
<p>Related code:</p>
<pre data-lang="c" style="background-color:#fafafa;color:#383a42;" class="language-c "><code class="language-c" data-lang="c"><span style="color:#a0a1a7;">// mm/mempolicy.c:639
</span><span style="color:#a626a4;">unsigned long </span><span style="color:#0184bc;">change_prot_numa</span><span>(</span><span style="color:#a626a4;">struct</span><span> vm_area_struct </span><span style="color:#a626a4;">*</span><span style="color:#e45649;">vma</span><span>,
</span><span>			</span><span style="color:#a626a4;">unsigned long </span><span style="color:#e45649;">addr</span><span>, </span><span style="color:#a626a4;">unsigned long </span><span style="color:#e45649;">end</span><span>)
</span><span>
</span></code></pre>
<h2 id="numa-migration">NUMA migration</h2>


    </main>

    <footer>
      
  <p class="taxonomies">
    
  </p>


      
    </footer>
  </div>
</body>

</html>
