<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible" />
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />

  
    
  

  
    
  

  
    
  

  

  
    
  

  <title>Linux active&#x2F;inactive lists</title>

  
    <meta name="title" content="Linux active&#x2F;inactive lists">
    <meta name="author" content="Junliang Hu">
    <meta name="description" content="Junliang Hu&#x27;s homepage">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jlhu.io/2023-08/linux-active-inactive-lists/">
    <meta property="og:site_name" content="Junliang Hu 胡俊良">
    <meta property="og:title" content="Linux active&#x2F;inactive lists">
    <meta property="og:description" content="Junliang Hu&#x27;s homepage">
    

    
    
      <meta property="twitter:card" content="summary_large_image">
      <meta property="twitter:url" content="https://jlhu.io/2023-08/linux-active-inactive-lists/">
      <meta property="twitter:title" content="Linux active&#x2F;inactive lists">
      <meta property="twitter:description" content="Junliang Hu&#x27;s homepage">
      
    

    <link rel="canonical" href="https://jlhu.io/2023-08/linux-active-inactive-lists/">
    
    <script type="application/ld+json">
      {
          "description": "Junliang Hu's homepage",
          "url": "https://jlhu.io/2023-08/linux-active-inactive-lists/",
          "@type": "WebSite",
          "headline": "Linux active/inactive lists",
          "name": "Linux active/inactive lists",
          "author": { "@type": "Person", "name": "Junliang Hu" },
          "@context":"https://schema.org"
      }
    </script>
  

  

   
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
            // customised options
            // • auto-render specific keys, e.g.:
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            // • rendering keys, e.g.:
            throwOnError : false
          });
      });
  </script>
  

  
    <link rel="stylesheet" href="https://jlhu.io/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
  
</head>

<body theme="auto">
  <div class="w">
    <header>
      
        <nav>
          
            <a href="/" >~jlhu</a>
          
            <a href="/tags" >#tags</a>
          
        </nav>
      

      
  <p>
    <a href="..">..</a>/linux-active-inactive-lists
  </p>
  <p class="post-meta">
    <time datetime="2023-08-10">2023-08-10</time>
  </p>
  <h1>Linux active&#x2F;inactive lists</h1>

    </header>

    <main class="page-content" aria-label="Content">
      
  

  <p>The active/inactive lists is Linux's attempt in implementing a LRU.
This kind of LRU is often referenced as split-LRU <sup class="footnote-reference"><a href="#1">1</a></sup> by the Linux community.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://lpc.events/event/11/contributions/896/attachments/793/1493/slides-r2.pdf">Overview of Memory Reclaim in the Current Upstream Kernel</a></p>
</div>
<p><img src="../linux-active-inactive-lists-overview.png" alt="overview" /></p>
<h2 id="how-it-works">How it works?</h2>
<ul>
<li>Two FIFO linked list i.e. active and inactive list</li>
<li>New page are inserted to the inactive list by page fault handler when they are first touched</li>
<li>During memory reclamation, every page in both lists will be checked
<ul>
<li>(one reclamation is referred as one round)</li>
<li>Active list check will be skipped to keep the length ratio:
<ul>
<li><code>len(inactive) ≈ sqrt(len(all))</code></li>
</ul>
</li>
</ul>
</li>
<li>The check mainly relies on two bits of information, i.e. hardware access bit in the PTE and software referenced bit in the page metadata
<ul>
<li>Software referenced bit track if the page is accessed last round</li>
</ul>
</li>
<li>Inactive pages could have 3 outcomes: activation, demotion and re-enlist
<ul>
<li>Activation criteria:
<ul>
<li>Accessed multiple time this round, or</li>
<li>Accessed both this and last round, or</li>
<li>(storing executable data and accessed this round)</li>
</ul>
</li>
<li>Demotion criteria:
<ul>
<li>Not accessed this round</li>
</ul>
</li>
<li>Re-enlist criteria:
<ul>
<li>Only accessed this round</li>
</ul>
</li>
</ul>
</li>
<li>Active pages are always put back to inactive list except:
<ul>
<li>(storing executable data and accessed this round)</li>
</ul>
</li>
</ul>
<h2 id="observations">Observations</h2>
<ul>
<li>Apart from new page insertion, LRU is only updated during memory reclamation i.e. when usable memory for a paticular node is below water mark
<ul>
<li>Slow reaction to tier memory</li>
</ul>
</li>
<li>Inactive list length is kept around square root of total managed page count via deactivation throttling
<ul>
<li>Most pages are “hot” =&gt; inaccurate hotness estimation</li>
</ul>
</li>
<li>Active pages are put back to inactive list carelessly
<ul>
<li>Demotion could pick suboptimal targets</li>
</ul>
</li>
</ul>


    </main>

    <footer>
      
  <p class="taxonomies">
    
  </p>


      
    </footer>
  </div>
</body>

</html>
