+++
title = "Sample Collection Latency"
date = "2024-01-22"
# [extra]
# add_toc = true
+++

## Architectural Perf Core Latency
We know that during context switch,
`x86_pmu.drain_pebs()` or `intel_pmu_drain_pebs_icl()` in our case,
will be called to collect PEBS samples.
By measuring how many times it is called,
we can calculate the average duration
that a group of samples sits in the PEBS buffer.


<details><summary>First run</summary>

```sh
clear@clr ~ $ sudo timeout 10s  bpftrace -e 'kfunc:intel_pmu_drain_pebs_icl {@[kstack]=count();}'
Attaching 1 probe...


@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rmap_walk_file+206
    migrate_pages_batch+2452
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_tasks_one_gp+903
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    hwrng_fillfn+119
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    __mutex_lock+40
    bpf_trampoline_unlink_prog+40
    bpf_tracing_link_release+25
    bpf_link_release+89
    __fput+257
    __x64_sys_close+115
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    __x64_sys_rt_sigsuspend+152
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    syscall_exit_to_user_mode+44
    do_syscall_64+77
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __wait_rcu_gp+265
    synchronize_rcu+203
    register_ftrace_direct+240
    bpf_trampoline_update+1062
    __bpf_trampoline_link_prog+361
    bpf_trampoline_link_prog+45
    bpf_tracing_prog_attach+737
    bpf_raw_tp_link_attach+330
    bpf_raw_tracepoint_open+161
    __sys_bpf+479
    __x64_sys_bpf+28
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    migrate_pages_batch+308
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rcu_do_batch+875
    rcu_nocb_cb_kthread+505
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    shmem_inode_acct_block+78
    shmem_alloc_and_acct_folio+60
    shmem_get_folio_gfp+1004
    shmem_fault+127
    __do_fault+65
    do_pte_missing+1020
    handle_mm_fault+1610
    do_user_addr_fault+825
    exc_page_fault+120
    asm_exc_page_fault+38
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    smpboot_thread_fn+230
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rmap_walk_file+206
    migrate_pages_batch+2452
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    kjournald2+354
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_sys_poll+1278
    __x64_sys_poll+160
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    __flush_work+106
    __lru_add_drain_all+447
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_preempt_disabled+18
    down_read_killable+688
    mmap_read_lock_killable+19
    lock_mm_and_find_vma+289
    do_user_addr_fault+674
    exc_page_fault+120
    asm_exc_page_fault+38
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    bit_wait_io+17
    __wait_on_bit+198
    out_of_line_wait_on_bit+126
    jbd2_journal_commit_transaction+4052
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    do_nanosleep+67
    hrtimer_nanosleep+130
    __x64_sys_clock_nanosleep+207
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_preempt_disabled+18
    __mutex_lock+609
    placement_thread_fn_policy+1486
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    bit_wait_io+17
    __wait_on_bit+198
    out_of_line_wait_on_bit+126
    jbd2_journal_commit_transaction+3573
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_common_interrupt+38
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_preempt_disabled+18
    rwsem_down_write_slowpath+652
    down_write_killable+101
    vm_mmap_pgoff+132
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    migrate_pages_batch+2195
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    rq_qos_wait+213
    wbt_wait+196
    __rq_qos_throttle+48
    blk_mq_submit_bio+582
    submit_bio_noacct_nocheck+597
    ext4_bio_write_folio+1034
    mpage_process_page_bufs+389
    mpage_prepare_extent_to_map+755
    ext4_do_writepages+808
    ext4_writepages+285
    do_writepages+227
    __writeback_single_inode+94
    writeback_sb_inodes+675
    __writeback_inodes_wb+152
    wb_writeback+311
    wb_workfn+847
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    futex_wait+252
    do_futex+240
    __x64_sys_futex+283
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    pipe_read+648
    vfs_read+557
    ksys_read+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 5
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    migration_entry_wait_on_locked+444
    migration_entry_wait+159
    do_swap_page+2281
    handle_mm_fault+1562
    do_user_addr_fault+825
    exc_page_fault+120
    asm_exc_page_fault+38
    __get_user_8+17
    __rseq_handle_notify_resume+88
    exit_to_user_mode_loop+144
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_exc_page_fault+38
]: 5
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_preempt_disabled+18
    __mutex_lock+1124
    placement_thread_fn_policy+1486
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 7
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_call_function_single+26
]: 7
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_sys_poll+1278
    __x64_sys_ppoll+250
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 8
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_exc_page_fault+38
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    synchronize_rcu_expedited+828
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    synchronize_rcu_expedited+916
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 11
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    nocb_gp_sleep+158
    rcu_nocb_gp_kthread+2195
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 15
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    smpboot_thread_fn+240
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 15
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_gp_kthread+200
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 18
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __flush_work+664
    __lru_add_drain_all+447
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 22
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_nocb_gp_kthread+2137
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 25
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    process_scheduled_works+761
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 26
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_nocb_cb_kthread+177
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 26
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+221
    do_sys_poll+1278
    __x64_sys_ppoll+250
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 32
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    synchronize_rcu_expedited+828
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 33
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_reschedule_ipi+26
]: 34
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    devkmsg_read+275
    vfs_read+213
    ksys_read+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 35
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    kcompactd+1718
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 36
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+221
    do_epoll_wait+1531
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 41
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    synchronize_rcu_expedited+916
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 81
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    placement_thread_fn_migration+446
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 85
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    synchronize_rcu_expedited_wait_once+327
    rcu_exp_sel_wait_wake+955
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 90
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_epoll_wait+1531
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 90
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_gp_fqs_loop+449
    rcu_gp_kthread+38
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 159
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    worker_thread+141
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 209
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    migration_entry_wait_on_locked+444
    migration_entry_wait+159
    do_swap_page+2281
    handle_mm_fault+1562
    do_user_addr_fault+452
    exc_page_fault+120
    asm_exc_page_fault+38
]: 215
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_apic_timer_interrupt+26
]: 227
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule_idle+35
    do_idle+510
    cpu_startup_entry+41
    rest_init+271
    arch_call_rest_init+14
    start_kernel+909
    x86_64_start_reservations+36
    x86_64_start_kernel+98
    secondary_startup_64_no_verify+364
]: 637
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule_idle+35
    do_idle+510
    cpu_startup_entry+41
    start_secondary+130
    secondary_startup_64_no_verify+364
]: 806
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    placement_thread_fn_policy+531
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 815
```
</details>

<details><summary>Second run</summary>

```sh
clear@clr ~ $ sudo timeout 10s  bpftrace -e 'kfunc:intel_pmu_drain_pebs_icl {@[kstack]=count();}'
Attaching 1 probe...


@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rcu_gp_cleanup+666
    rcu_gp_kthread+52
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    smpboot_thread_fn+230
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    kswapd+615
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    syscall_exit_to_user_mode+44
    do_syscall_64+77
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __wait_rcu_gp+265
    synchronize_rcu+203
    register_ftrace_direct+240
    bpf_trampoline_update+1062
    __bpf_trampoline_link_prog+361
    bpf_trampoline_link_prog+45
    bpf_tracing_prog_attach+737
    bpf_raw_tp_link_attach+330
    bpf_raw_tracepoint_open+161
    __sys_bpf+479
    __x64_sys_bpf+28
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rmap_walk_file+206
    migrate_pages_batch+2452
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_tasks_wait_gp+388
    rcu_tasks_one_gp+1026
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_tasks_kthread+176
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __wait_rcu_gp+265
    synchronize_rcu+203
    rcu_tasks_wait_gp+302
    rcu_tasks_one_gp+1026
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    shrink_lruvec+2333
    shrink_node+1112
    kswapd+2058
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    kswapd+393
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    __x64_sys_rt_sigsuspend+152
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    bit_wait_io+17
    __wait_on_bit+198
    out_of_line_wait_on_bit+126
    jbd2_journal_commit_transaction+3573
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    jbd2_journal_commit_transaction+4035
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_call_function_single+26
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    bit_wait_io+17
    __wait_on_bit+198
    out_of_line_wait_on_bit+126
    jbd2_journal_commit_transaction+4052
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    kjournald2+354
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_tasks_one_gp+903
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_reschedule_ipi+26
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    kswapd+2171
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 3
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_common_interrupt+38
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    __flush_work+106
    __lru_add_drain_all+447
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 5
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_preempt_disabled+18
    __mutex_lock+1124
    placement_thread_fn_policy+1486
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 5
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_sys_poll+1278
    __x64_sys_poll+160
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 5
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    pipe_read+648
    vfs_read+557
    ksys_read+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    do_nanosleep+67
    hrtimer_nanosleep+130
    __x64_sys_clock_nanosleep+207
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_sys_poll+1278
    __x64_sys_ppoll+250
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 14
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __flush_work+664
    __lru_add_drain_all+447
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 16
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    synchronize_rcu_expedited+828
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 16
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    nocb_gp_sleep+158
    rcu_nocb_gp_kthread+2195
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 23
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_gp_kthread+200
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 25
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_apic_timer_interrupt+26
]: 27
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_nocb_gp_kthread+2137
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 28
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    process_scheduled_works+761
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 28
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_nocb_cb_kthread+177
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 28
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_gp_fqs_loop+449
    rcu_gp_kthread+38
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 29
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    devkmsg_read+275
    vfs_read+213
    ksys_read+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 37
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    synchronize_rcu_expedited+828
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 39
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    kcompactd+1718
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 40
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    smpboot_thread_fn+240
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 41
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+221
    do_epoll_wait+1531
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 51
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    synchronize_rcu_expedited+916
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 75
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    synchronize_rcu_expedited+916
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 90
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    placement_thread_fn_migration+446
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 93
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_epoll_wait+1531
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 98
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+221
    do_sys_poll+1278
    __x64_sys_ppoll+250
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 139
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    synchronize_rcu_expedited_wait_once+327
    rcu_exp_sel_wait_wake+955
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 149
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    migration_entry_wait_on_locked+444
    migration_entry_wait+159
    do_swap_page+2281
    handle_mm_fault+1562
    do_user_addr_fault+452
    exc_page_fault+120
    asm_exc_page_fault+38
]: 216
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    worker_thread+141
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 255
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule_idle+35
    do_idle+510
    cpu_startup_entry+41
    rest_init+271
    arch_call_rest_init+14
    start_kernel+909
    x86_64_start_reservations+36
    x86_64_start_kernel+98
    secondary_startup_64_no_verify+364
]: 348
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    placement_thread_fn_policy+531
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 883
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_prog_ee0e253c78993a24_sd_devices+24223
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule_idle+35
    do_idle+510
    cpu_startup_entry+41
    start_secondary+130
    secondary_startup_64_no_verify+364
]: 1449
```
</details>

<details><summary>Third run</summary>

```sh
clear@clr ~ $ sudo timeout 10s  bpftrace -e 'kfunc:intel_pmu_drain_pebs_icl {@[kstack]=count();}'
Attaching 1 probe...


ERROR: failed to look up stack id -17 (pid -1): -2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    rq_qos_wait+213
    wbt_wait+196
    __rq_qos_throttle+48
    blk_mq_submit_bio+582
    submit_bio_noacct_nocheck+597
    ext4_io_submit+44
    ext4_do_writepages+830
    ext4_writepages+285
    do_writepages+227
    __writeback_single_inode+94
    writeback_sb_inodes+675
    __writeback_inodes_wb+152
    wb_writeback+311
    wb_workfn+847
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rcu_gp_cleanup+666
    rcu_gp_kthread+52
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    migration_entry_wait_on_locked+444
    migration_entry_wait+159
    do_swap_page+2281
    handle_mm_fault+1562
    do_user_addr_fault+825
    exc_page_fault+120
    asm_exc_page_fault+38
    __put_user_nocheck_4+7
    do_epoll_wait+767
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    wait_for_common+32
    __wait_rcu_gp+265
    synchronize_rcu+203
    rcu_tasks_wait_gp+302
    rcu_tasks_one_gp+1026
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_tasks_kthread+176
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    mempool_alloc+55
    btree_insert_level+664
    indexable_heap_swap_and_update_index+147
    indexable_heap_insert+395
    placement_thread_fn_policy+1657
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __wait_rcu_gp+265
    synchronize_rcu+203
    register_ftrace_direct+240
    bpf_trampoline_update+1062
    __bpf_trampoline_link_prog+361
    bpf_trampoline_link_prog+45
    bpf_tracing_prog_attach+737
    bpf_raw_tp_link_attach+330
    bpf_raw_tracepoint_open+161
    __sys_bpf+479
    __x64_sys_bpf+28
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    fuse_simple_request+933
    fuse_direct_io+2038
    fuse_file_write_iter+361
    vfs_write+730
    ksys_write+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rmap_walk_file+206
    try_to_migrate+172
    migrate_pages_batch+786
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    dput+37
    path_put+22
    do_faccessat+518
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    __x64_sys_rt_sigsuspend+152
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    migrate_pages_batch+2195
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_tasks_wait_gp+388
    rcu_tasks_one_gp+1026
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __wait_rcu_gp+265
    synchronize_rcu+203
    rcu_tasks_wait_gp+302
    rcu_tasks_one_gp+1026
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    jbd2_journal_commit_transaction+4035
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 1
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_sys_poll+1278
    __x64_sys_poll+160
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_tasks_one_gp+903
    rcu_tasks_kthread+164
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    bit_wait_io+17
    __wait_on_bit+198
    out_of_line_wait_on_bit+126
    jbd2_journal_commit_transaction+4052
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    bit_wait_io+17
    __wait_on_bit+198
    out_of_line_wait_on_bit+126
    jbd2_journal_commit_transaction+3573
    kjournald2+173
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    slab_pre_alloc_hook+62
    __kmem_cache_alloc_node+60
    __kmalloc_node+158
    kvmalloc_node+69
    migration_do+812
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    __flush_work+106
    __lru_add_drain_all+447
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rcu_do_batch+875
    rcu_nocb_cb_kthread+505
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    kjournald2+354
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 2
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    rq_qos_wait+213
    wbt_wait+196
    __rq_qos_throttle+48
    blk_mq_submit_bio+582
    submit_bio_noacct_nocheck+597
    ext4_io_submit+44
    ext4_do_writepages+1256
    ext4_writepages+285
    do_writepages+227
    __writeback_single_inode+94
    writeback_sb_inodes+675
    __writeback_inodes_wb+152
    wb_writeback+311
    wb_workfn+847
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 3
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rmap_walk_file+206
    migrate_pages_batch+2452
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    migrate_pages_batch+2195
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 4
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    rmap_walk_file+206
    migrate_pages_batch+2452
    migrate_pages+2505
    migration_do+1218
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 5
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_preempt_disabled+18
    __mutex_lock+1124
    placement_thread_fn_policy+1486
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 6
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    process_scheduled_works+761
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 7
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    do_nanosleep+67
    hrtimer_nanosleep+130
    __x64_sys_clock_nanosleep+207
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    rq_qos_wait+213
    wbt_wait+196
    __rq_qos_throttle+48
    blk_mq_submit_bio+582
    submit_bio_noacct_nocheck+597
    ext4_bio_write_folio+1034
    mpage_process_page_bufs+389
    mpage_prepare_extent_to_map+755
    ext4_do_writepages+808
    ext4_writepages+285
    do_writepages+227
    __writeback_single_inode+94
    writeback_sb_inodes+675
    __writeback_inodes_wb+152
    wb_writeback+311
    wb_workfn+847
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    syscall_exit_to_user_mode+44
    do_syscall_64+77
    entry_SYSCALL_64_after_hwframe+70
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_sys_poll+1278
    __x64_sys_ppoll+250
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 10
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    pipe_read+648
    vfs_read+557
    ksys_read+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 11
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+36
    wait_for_common+240
    __flush_work+664
    __lru_add_drain_all+447
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 14
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    smpboot_thread_fn+240
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 15
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    nocb_gp_sleep+158
    rcu_nocb_gp_kthread+2195
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 16
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    rcu_gp_fqs_loop+449
    rcu_gp_kthread+38
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 18
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_gp_kthread+200
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 18
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_nocb_cb_kthread+177
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 18
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    rcu_nocb_gp_kthread+2137
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 18
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    kcompactd+1718
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 38
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_call_function_single+26
]: 39
@[]: 40
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    devkmsg_read+275
    vfs_read+213
    ksys_read+92
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 45
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    __cond_resched+49
    synchronize_rcu_expedited+828
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 52
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+221
    do_epoll_wait+1531
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 52
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    synchronize_rcu_expedited+916
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+701
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 61
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    synchronize_rcu_expedited+916
    lru_cache_disable+21
    migration_do+147
    placement_thread_fn_migration+722
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 64
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule_idle+35
    do_idle+510
    cpu_startup_entry+41
    rest_init+271
    arch_call_rest_init+14
    start_kernel+909
    x86_64_start_reservations+36
    x86_64_start_kernel+98
    secondary_startup_64_no_verify+364
]: 79
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    placement_thread_fn_migration+446
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 90
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    synchronize_rcu_expedited_wait_once+327
    rcu_exp_sel_wait_wake+955
    process_scheduled_works+629
    worker_thread+620
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 95
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+158
    do_epoll_wait+1531
    __x64_sys_epoll_wait+151
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 98
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_reschedule_ipi+26
]: 134
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_common_interrupt+38
]: 159
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_hrtimeout_range_clock+221
    do_sys_poll+1278
    __x64_sys_ppoll+250
    do_syscall_64+65
    entry_SYSCALL_64_after_hwframe+70
]: 176
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    worker_thread+141
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 291
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule_idle+35
    do_idle+510
    cpu_startup_entry+41
    start_secondary+130
    secondary_startup_64_no_verify+364
]: 699
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    io_schedule+75
    migration_entry_wait_on_locked+444
    migration_entry_wait+159
    do_swap_page+2281
    handle_mm_fault+1562
    do_user_addr_fault+452
    exc_page_fault+120
    asm_exc_page_fault+38
]: 806
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    schedule_timeout+121
    placement_thread_fn_policy+531
    kthread+279
    ret_from_fork+52
    ret_from_fork_asm+17
]: 846
@[
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_prog_ee0e253c78993a24_sd_devices+24243
    bpf_trampoline_6442490326+75
    intel_pmu_drain_pebs_icl+9
    intel_pmu_pebs_sched_task+97
    intel_pmu_sched_task+22
    perf_pmu_sched_task+199
    __perf_event_task_sched_out+53
    __sched_text_start+2772
    schedule+104
    exit_to_user_mode_loop+39
    exit_to_user_mode_prepare+77
    irqentry_exit_to_user_mode+9
    asm_sysvec_apic_timer_interrupt+26
]: 1222
```
</details>


<details><summary>Processing results</summary>

```sh
jlhu@mbp14 ~> pbpaste | awk '/\]:\ / { sum += $2 } END { print sum }'
3881
jlhu@mbp14 ~> pbpaste | awk '/\]:\ / { sum += $2 } END { print sum }'
4305
jlhu@mbp14 ~> pbpaste | awk '/\]:\ / { sum += $2 } END { print sum }'
5314
```
</details>

| Test time (s) | Called | Average duration (ms) |
| ------------- | ------ | --------------------- |
| 10            | 3881   | 2.58                  |
| 10            | 4305   | 2.32                  |
| 10            | 5314   | 1.88                  |

This data is relativly close to the CFS scheduling time slice of 0.75*(1+ilog(ncpus)) ms.
<details><summary>Code</summary>

```c
// kernel/sched/fair.c
/*
 * Minimal preemption granularity for CPU-bound tasks:
 *
 * (default: 0.75 msec * (1 + ilog(ncpus)), units: nanoseconds)
 */
unsigned int sysctl_sched_base_slice			= 750000ULL;
static unsigned int normalized_sysctl_sched_base_slice	= 750000ULL;
```
</details>
